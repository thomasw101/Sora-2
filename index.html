<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$SORA - The Story of Sora</title>
  <meta name="description" content="A living story written by the market. Watch Sora's journey unfold in real-time.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Space+Mono:wght@400;700&family=Cinzel:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --parchment: #f4e4c8;
      --ink: #2a1f15;
      --gold: #c4a87c;
      --gold-bright: #e8d4a8;
      --ember: #f97316;
      --cyber-green: #4ade80;
      --cyber-red: #f87171;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Crimson Text', Georgia, serif;
      background: #0a0806;
      color: var(--parchment);
      overflow-x: hidden;
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"><circle cx="4" cy="4" r="3" fill="%23c4a87c" opacity="0.8"/></svg>') 4 4, crosshair;
    }

    /* ==================== GLOBAL DRAWING CANVAS ==================== */
    #global-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }

    body.drawing #global-canvas { pointer-events: auto; }

    /* ==================== PARTICLES ==================== */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      animation: floatParticle 20s infinite ease-in-out;
      opacity: 0;
    }

    .particle.ember { width: 3px; height: 3px; background: var(--ember); box-shadow: 0 0 6px var(--ember); }
    .particle.ash { width: 2px; height: 2px; background: rgba(200, 180, 150, 0.5); }
    .particle.cyber { width: 1px; height: 1px; background: var(--cyber-green); box-shadow: 0 0 4px var(--cyber-green); }

    @keyframes floatParticle {
      0% { transform: translateY(100vh) translateX(0); opacity: 0; }
      10% { opacity: 0.8; }
      90% { opacity: 0.8; }
      100% { transform: translateY(-10vh) translateX(50px); opacity: 0; }
    }

    /* ==================== CYBER GRID ==================== */
    .cyber-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(196, 168, 124, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(196, 168, 124, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 2;
    }

    /* ==================== HERO ==================== */
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: radial-gradient(ellipse at center bottom, #1a1510 0%, #0a0806 70%);
      padding: 40px 20px;
      overflow: hidden;
    }

    .hero-bg-glow {
      position: absolute;
      width: 800px;
      height: 800px;
      background: radial-gradient(circle, rgba(196, 168, 124, 0.1) 0%, transparent 60%);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: pulseGlow 4s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
    }

    .hero-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 60px;
      z-index: 10;
      flex-wrap: wrap;
      max-width: 1200px;
    }

    .hero-text { text-align: center; max-width: 600px; }

    .hero-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(2.5rem, 7vw, 4.5rem);
      font-weight: 400;
      letter-spacing: 0.12em;
      color: var(--gold);
      text-shadow: 0 0 60px rgba(196, 168, 124, 0.4);
      margin-bottom: 10px;
      animation: titleReveal 1.5s ease-out;
    }

    @keyframes titleReveal {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hero-subtitle {
      font-family: 'Space Mono', monospace;
      font-size: clamp(1rem, 3vw, 1.4rem);
      letter-spacing: 0.4em;
      color: var(--gold-bright);
      margin-bottom: 30px;
      animation: subtitleReveal 1.5s ease-out 0.3s both;
    }

    @keyframes subtitleReveal {
      from { opacity: 0; letter-spacing: 0.8em; }
      to { opacity: 1; letter-spacing: 0.4em; }
    }

    .hero-tagline {
      font-size: 1.15rem;
      font-style: italic;
      color: rgba(244, 228, 200, 0.7);
      max-width: 450px;
      margin: 0 auto 35px;
      line-height: 1.7;
      animation: fadeIn 1.5s ease-out 0.6s both;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .hero-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      animation: fadeIn 1.5s ease-out 0.9s both;
    }

    .btn {
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      letter-spacing: 0.1em;
      padding: 14px 32px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      text-transform: uppercase;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--gold) 0%, #a08050 100%);
      color: var(--ink);
      box-shadow: 0 4px 20px rgba(196, 168, 124, 0.3);
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }

    .btn-primary:hover::before { left: 100%; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 30px rgba(196, 168, 124, 0.5); }

    .btn-secondary {
      background: transparent;
      color: var(--gold);
      border: 1px solid var(--gold);
    }

    .btn-secondary:hover { background: rgba(196, 168, 124, 0.15); }

    .hero-sora {
      position: relative;
      animation: floatSora 6s ease-in-out infinite;
    }

    .hero-sora img {
      width: 320px;
      max-width: 80vw;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.6));
    }

    .sora-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 350px;
      height: 350px;
      background: radial-gradient(circle, rgba(249, 115, 22, 0.15) 0%, transparent 60%);
      animation: soraGlow 3s ease-in-out infinite alternate;
      z-index: -1;
    }

    @keyframes floatSora {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    @keyframes soraGlow {
      0% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.15); }
    }

    .scroll-indicator {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: var(--gold);
      opacity: 0.5;
      animation: bounce 2s infinite;
      z-index: 10;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(10px); }
    }

    .scroll-indicator span { font-family: 'Space Mono', monospace; font-size: 0.75rem; letter-spacing: 0.2em; }

    /* ==================== LIVE STORY ==================== */
    .live-story {
      min-height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .live-header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 25px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      z-index: 10;
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(220, 38, 38, 0.15);
      border: 1px solid rgba(220, 38, 38, 0.4);
      padding: 10px 18px;
      border-radius: 8px;
      animation: liveGlow 2s ease-in-out infinite;
    }

    @keyframes liveGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(220, 38, 38, 0.2); }
      50% { box-shadow: 0 0 20px rgba(220, 38, 38, 0.4); }
    }

    .live-dot {
      width: 10px;
      height: 10px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .live-badge span { font-family: 'Space Mono', monospace; font-size: 0.8rem; color: #ef4444; letter-spacing: 0.15em; }

    .era-badge {
      font-family: 'Cinzel', serif;
      font-size: 1.1rem;
      letter-spacing: 0.2em;
      color: var(--gold);
      text-shadow: 0 0 20px rgba(196, 168, 124, 0.3);
    }

    .beat-badge {
      font-family: 'Space Mono', monospace;
      font-size: 0.8rem;
      color: rgba(196, 168, 124, 0.6);
      background: rgba(196, 168, 124, 0.08);
      padding: 10px 18px;
      border-radius: 8px;
      border: 1px solid rgba(196, 168, 124, 0.15);
    }

    .beat-badge span { color: var(--gold); }

    .book-container {
      position: relative;
      width: 100%;
      max-width: 1000px;
      aspect-ratio: 16/10;
    }

    .book-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 30px 60px rgba(0,0,0,0.8));
    }

    .narrative-overlay {
      position: absolute;
      top: 12%;
      left: 8%;
      right: 8%;
      bottom: 15%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .narrative-text {
      font-size: clamp(1.1rem, 2.5vw, 1.6rem);
      line-height: 1.9;
      color: var(--ink);
      text-align: center;
      font-style: italic;
      max-width: 85%;
      opacity: 0;
      transition: opacity 0.6s ease;
      text-shadow: 0 1px 2px rgba(255,255,255,0.3);
    }

    .narrative-text.visible { opacity: 1; }

    .narrative-text.typing::after {
      content: '|';
      animation: blink 0.5s infinite;
      color: var(--ink);
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .control-btn {
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      padding: 10px 20px;
      background: rgba(196, 168, 124, 0.08);
      border: 1px solid rgba(196, 168, 124, 0.25);
      color: var(--gold);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-btn:hover { background: rgba(196, 168, 124, 0.15); border-color: rgba(196, 168, 124, 0.4); }
    .control-btn.active { background: rgba(74, 222, 128, 0.1); border-color: rgba(74, 222, 128, 0.4); color: var(--cyber-green); }

    .tech-pipeline {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 35px;
      padding: 18px 25px;
      background: rgba(10, 8, 6, 0.9);
      border-radius: 12px;
      border: 1px solid rgba(196, 168, 124, 0.15);
      flex-wrap: wrap;
      backdrop-filter: blur(10px);
    }

    .pipeline-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
    }

    .node-icon {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      position: relative;
    }

    .node-icon.price { background: linear-gradient(135deg, #0f3d1f, #1a5c30); }
    .node-icon.price.down { background: linear-gradient(135deg, #3d0f0f, #5c1a1a); }
    .node-icon.ai { background: linear-gradient(135deg, #0f1f3d, #1a305c); }
    .node-icon.story { background: linear-gradient(135deg, #3d2a0f, #5c401a); }
    .node-icon.voice { background: linear-gradient(135deg, #2a0f3d, #401a5c); }

    .node-pulse {
      position: absolute;
      top: -2px;
      right: -2px;
      width: 10px;
      height: 10px;
      background: var(--cyber-green);
      border-radius: 50%;
      animation: nodePulse 2s infinite;
    }

    @keyframes nodePulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.4); }
      50% { opacity: 0.6; box-shadow: 0 0 0 6px rgba(74, 222, 128, 0); }
    }

    .node-label { font-family: 'Space Mono', monospace; font-size: 0.6rem; letter-spacing: 0.1em; color: rgba(196, 168, 124, 0.5); text-transform: uppercase; }
    .node-value { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: var(--gold); }
    .node-value.up { color: var(--cyber-green); }
    .node-value.down { color: var(--cyber-red); }

    .pipeline-arrow { color: rgba(196, 168, 124, 0.3); font-size: 1.2rem; animation: arrowPulse 1.5s infinite; }

    @keyframes arrowPulse {
      0%, 100% { opacity: 0.3; transform: translateX(0); }
      50% { opacity: 0.8; transform: translateX(3px); }
    }

    /* ==================== FOUNDLING ==================== */
    .foundling {
      padding: 100px 20px;
      background: linear-gradient(180deg, #0a0806 0%, #1a1510 50%, #0a0806 100%);
    }

    .section-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.8rem, 5vw, 2.5rem);
      text-align: center;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 50px;
    }

    .lore-container { max-width: 800px; margin: 0 auto; }

    .lore-scroll {
      background: linear-gradient(180deg, var(--parchment) 0%, #e8d8c0 100%);
      padding: 50px 45px;
      border-radius: 4px;
      position: relative;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    .lore-scroll::before, .lore-scroll::after {
      content: '';
      position: absolute;
      left: -8px;
      right: -8px;
      height: 25px;
      background: linear-gradient(90deg, #7a6348, #5a4838, #7a6348);
      border-radius: 12px;
    }

    .lore-scroll::before { top: -12px; }
    .lore-scroll::after { bottom: -12px; }

    .lore-text { font-size: 1.1rem; line-height: 1.9; color: var(--ink); text-align: justify; }
    .lore-text p { margin-bottom: 18px; }
    .lore-text p:last-child { margin-bottom: 0; }

    /* ==================== TOKENOMICS ==================== */
    .tokenomics { padding: 100px 20px; background: #0a0806; text-align: center; }

    .token-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 25px;
      max-width: 700px;
      margin: 0 auto 50px;
    }

    .token-card {
      background: rgba(196, 168, 124, 0.04);
      border: 1px solid rgba(196, 168, 124, 0.1);
      padding: 30px 20px;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .token-card:hover { border-color: rgba(196, 168, 124, 0.3); transform: translateY(-3px); }

    .token-value { font-family: 'Cinzel', serif; font-size: 1.8rem; color: var(--gold); margin-bottom: 8px; }
    .token-label { font-family: 'Space Mono', monospace; font-size: 0.7rem; color: rgba(244, 228, 200, 0.5); text-transform: uppercase; letter-spacing: 0.1em; }

    .contract-box {
      max-width: 550px;
      margin: 0 auto;
      padding: 20px 25px;
      background: rgba(42, 31, 21, 0.4);
      border: 1px solid rgba(196, 168, 124, 0.15);
      border-radius: 10px;
    }

    .contract-label { font-family: 'Space Mono', monospace; font-size: 0.65rem; color: rgba(196, 168, 124, 0.4); margin-bottom: 10px; text-transform: uppercase; }
    .contract-address { font-family: 'Space Mono', monospace; font-size: 0.8rem; color: var(--gold); word-break: break-all; }

    /* ==================== FOOTER ==================== */
    .footer { padding: 40px 20px; text-align: center; border-top: 1px solid rgba(196, 168, 124, 0.08); }

    .footer-links { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; }
    .footer-links a { color: var(--gold); text-decoration: none; font-family: 'Space Mono', monospace; font-size: 0.8rem; }
    .footer-links a:hover { opacity: 0.7; }

    .disclaimer { font-size: 0.7rem; color: rgba(244, 228, 200, 0.35); max-width: 550px; margin: 0 auto; line-height: 1.6; }

    .draw-hint {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-family: 'Space Mono', monospace;
      font-size: 0.7rem;
      color: rgba(196, 168, 124, 0.4);
      z-index: 100;
      pointer-events: none;
    }

    @media (max-width: 900px) {
      .hero-content { flex-direction: column-reverse; gap: 40px; }
      .hero-sora img { width: 250px; }
      .pipeline-arrow { display: none; }
    }

    #audio-player { display: none; }
  </style>
</head>
<body>
  <canvas id="global-canvas"></canvas>
  <div class="particles" id="particles"></div>
  <div class="cyber-grid"></div>
  <div class="draw-hint">‚úèÔ∏è Click Draw Mode, then draw anywhere</div>

  <!-- HERO -->
  <section class="hero" id="hero">
    <div class="hero-bg-glow"></div>
    <div class="hero-content">
      <div class="hero-text">
        <h1 class="hero-title">THE STORY OF SORA</h1>
        <div class="hero-subtitle">$SORA</div>
        <p class="hero-tagline">A living story written by the market. Every trade shapes his journey. Every holder becomes part of the legend.</p>
        <div class="hero-buttons">
          <a href="#live-story" class="btn btn-primary">Watch the Story</a>
          <a id="buy-btn" href="#" target="_blank" class="btn btn-secondary">Buy $SORA</a>
        </div>
      </div>
      <div class="hero-sora">
        <div class="sora-glow"></div>
        <img src="sora.png" alt="Sora">
      </div>
    </div>
    <div class="scroll-indicator"><span>SCROLL</span><span>‚Üì</span></div>
  </section>

  <!-- LIVE STORY -->
  <section class="live-story" id="live-story">
    <div class="live-header">
      <div class="live-badge"><div class="live-dot"></div><span>LIVE</span></div>
      <div class="era-badge" id="era-display">THE ASH</div>
      <div class="beat-badge">BEAT <span id="beat-display">#0</span></div>
    </div>

    <div class="book-container">
      <img src="book.png" alt="Story Book" class="book-image">
      <div class="narrative-overlay">
        <div class="narrative-text" id="narrative-text">Awaiting the story...</div>
      </div>
    </div>

    <div class="controls">
      <button class="control-btn" id="sound-btn"><span id="sound-icon">üîá</span><span id="sound-label">Enable Sound</span></button>
      <button class="control-btn" id="draw-btn"><span>‚úèÔ∏è</span><span>Draw Mode</span></button>
      <button class="control-btn" id="clear-btn"><span>üóëÔ∏è</span><span>Clear</span></button>
    </div>

    <div class="tech-pipeline">
      <div class="pipeline-node">
        <div class="node-icon price" id="price-icon">üìà<div class="node-pulse"></div></div>
        <div class="node-label">Price</div>
        <div class="node-value" id="price-value">$0</div>
      </div>
      <div class="pipeline-arrow">‚Üí</div>
      <div class="pipeline-node">
        <div class="node-icon ai">üß†<div class="node-pulse"></div></div>
        <div class="node-label">AI</div>
        <div class="node-value">Gemini</div>
      </div>
      <div class="pipeline-arrow">‚Üí</div>
      <div class="pipeline-node">
        <div class="node-icon story">üìñ<div class="node-pulse"></div></div>
        <div class="node-label">Story</div>
        <div class="node-value" id="story-value">Beat #0</div>
      </div>
      <div class="pipeline-arrow">‚Üí</div>
      <div class="pipeline-node">
        <div class="node-icon voice">üîä<div class="node-pulse"></div></div>
        <div class="node-label">Voice</div>
        <div class="node-value">TTS</div>
      </div>
    </div>
  </section>

  <!-- FOUNDLING -->
  <section class="foundling" id="foundling">
    <h2 class="section-title">THE FOUNDLING</h2>
    <div class="lore-container">
      <div class="lore-scroll">
        <div class="lore-text">
          <p>They left him in the ash. A boy of fifteen winters, with nothing but a wooden fox carved by his mother's hand and a blade pulled from a dead man's grip.</p>
          <p>The shrine had burned three days before he woke. He never found their bodies. Perhaps they fled. Perhaps they were taken. Perhaps they simply decided that survival would be easier without another mouth to feed.</p>
          <p>Sora does not speak of them. The wooden fox remembers. The blade forgets.</p>
          <p>Now he walks the dead roads between ruined villages, trading silence for shelter, violence for bread. Each day the empire of ash grows smaller behind him. Each night the wooden fox watches from his chest pocket, its painted eyes catching the firelight.</p>
          <p>They say a boy cannot build an empire. They say blood is thicker than ash. They say the old families will rise again and reclaim what was lost.</p>
          <p>Sora says nothing. He only walks. And behind him, in the shadows between the burnt trees, others have begun to follow.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- TOKENOMICS -->
  <section class="tokenomics" id="tokenomics">
    <h2 class="section-title">TOKENOMICS</h2>
    <div class="token-grid">
      <div class="token-card"><div class="token-value">1B</div><div class="token-label">Total Supply</div></div>
      <div class="token-card"><div class="token-value">0%</div><div class="token-label">Tax</div></div>
      <div class="token-card"><div class="token-value">100%</div><div class="token-label">Fair Launch</div></div>
    </div>
    <div class="contract-box">
      <div class="contract-label">Contract Address</div>
      <div class="contract-address" id="contract-display">Coming Soon...</div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-links">
      <a href="https://x.com/storytimeliveai" target="_blank">Twitter</a>
      <a id="footer-buy" href="#" target="_blank">Buy on Bags.fm</a>
    </div>
    <p class="disclaimer">$SORA is a meme coin with no intrinsic value or expectation of financial return. This is an art project and social experiment. Trade responsibly.</p>
  </footer>

  <audio id="audio-player"></audio>

  <script>
    const CONFIG = {
      TOKEN_ADDRESS: '3PTweY7diTmNuym8Ms26CvSitsVf2n7EQGp4AfaFpump',
      BUY_URL: 'https://bags.fm/YOUR_COIN',
      NARRATIVE_INTERVAL: 25000
    };

    document.getElementById('buy-btn').href = CONFIG.BUY_URL;
    document.getElementById('footer-buy').href = CONFIG.BUY_URL;
    if (CONFIG.TOKEN_ADDRESS !== 'Y3PTweY7diTmNuym8Ms26CvSitsVf2n7EQGp4AfaFpump') {
      document.getElementById('contract-display').textContent = CONFIG.TOKEN_ADDRESS;
    }

    // Particles
    const particlesEl = document.getElementById('particles');
    for (let i = 0; i < 50; i++) {
      const p = document.createElement('div');
      p.className = 'particle ' + ['ember', 'ash', 'cyber'][Math.floor(Math.random() * 3)];
      p.style.left = Math.random() * 100 + '%';
      p.style.animationDelay = Math.random() * 20 + 's';
      p.style.animationDuration = (15 + Math.random() * 15) + 's';
      particlesEl.appendChild(p);
    }

    const state = { soundEnabled: false, drawEnabled: false };
    const narrativeText = document.getElementById('narrative-text');
    const eraDisplay = document.getElementById('era-display');
    const beatDisplay = document.getElementById('beat-display');
    const priceValue = document.getElementById('price-value');
    const priceIcon = document.getElementById('price-icon');
    const storyValue = document.getElementById('story-value');
    const soundBtn = document.getElementById('sound-btn');
    const soundIcon = document.getElementById('sound-icon');
    const soundLabel = document.getElementById('sound-label');
    const drawBtn = document.getElementById('draw-btn');
    const clearBtn = document.getElementById('clear-btn');
    const audioPlayer = document.getElementById('audio-player');

    const eraNames = { 'THE_ASH': 'THE ASH', 'THE_GATE': 'THE GATE', 'THE_RONIN': 'THE RONIN', 'THE_EMPIRE': 'THE EMPIRE', 'THE_BEYOND': 'THE BEYOND' };

    async function typeText(text) {
      narrativeText.classList.add('visible', 'typing');
      narrativeText.textContent = '';
      for (const char of text) {
        narrativeText.textContent += char;
        await new Promise(r => setTimeout(r, char === '.' ? 80 : char === ',' ? 40 : 25));
      }
      narrativeText.classList.remove('typing');
    }

    function fadeOutNarrative() {
      return new Promise(resolve => {
        narrativeText.classList.remove('visible');
        setTimeout(resolve, 500);
      });
    }

    async function fetchNarrative() {
      try {
        const res = await fetch(`/api/narrative?token=${CONFIG.TOKEN_ADDRESS}&audio=${state.soundEnabled}`);
        return await res.json();
      } catch (e) { return null; }
    }

    async function displayNarrative(data) {
      if (!data) return;
      eraDisplay.textContent = eraNames[data.era] || data.era;
      beatDisplay.textContent = '#' + data.beatCount;
      storyValue.textContent = 'Beat #' + data.beatCount;
      if (data.marketCap) {
        priceValue.textContent = '$' + Math.round(data.marketCap).toLocaleString();
        priceValue.className = 'node-value' + (data.momentum === 'UP' ? ' up' : data.momentum === 'DOWN' ? ' down' : '');
        priceIcon.className = 'node-icon price' + (data.momentum === 'DOWN' ? ' down' : '');
      }
      await fadeOutNarrative();
      await typeText(data.narrative);
      if (state.soundEnabled && data.audio) {
        try {
          audioPlayer.src = URL.createObjectURL(new Blob([Uint8Array.from(atob(data.audio), c => c.charCodeAt(0))], { type: 'audio/mp3' }));
          audioPlayer.play();
        } catch (e) {}
      }
    }

    async function narrativeLoop() {
      const data = await fetchNarrative();
      await displayNarrative(data);
    }

    soundBtn.addEventListener('click', () => {
      state.soundEnabled = !state.soundEnabled;
      soundBtn.classList.toggle('active', state.soundEnabled);
      soundIcon.textContent = state.soundEnabled ? 'üîä' : 'üîá';
      soundLabel.textContent = state.soundEnabled ? 'Sound On' : 'Enable Sound';
    });

    // Drawing
    const canvas = document.getElementById('global-canvas');
    const ctx = canvas.getContext('2d');
    let strokes = [], isDrawing = false, lastX = 0, lastY = 0;

    function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function getPos(e) {
      return { x: e.clientX || (e.touches && e.touches[0].clientX), y: e.clientY || (e.touches && e.touches[0].clientY) };
    }

    function startDraw(e) {
      if (!state.drawEnabled) return;
      isDrawing = true;
      const pos = getPos(e);
      lastX = pos.x; lastY = pos.y;
    }

    function draw(e) {
      if (!isDrawing || !state.drawEnabled) return;
      const pos = getPos(e);
      strokes.push({ x1: lastX, y1: lastY, x2: pos.x, y2: pos.y, time: Date.now() });
      lastX = pos.x; lastY = pos.y;
    }

    function stopDraw() { isDrawing = false; }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseleave', stopDraw);
    canvas.addEventListener('touchstart', startDraw);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDraw);

    function renderStrokes() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const now = Date.now();
      strokes = strokes.filter(s => now - s.time < 10000);
      strokes.forEach(s => {
        const opacity = Math.max(0, 1 - (now - s.time) / 10000);
        ctx.strokeStyle = `rgba(196, 168, 124, ${opacity})`;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(s.x1, s.y1);
        ctx.lineTo(s.x2, s.y2);
        ctx.stroke();
      });
      requestAnimationFrame(renderStrokes);
    }
    renderStrokes();

    drawBtn.addEventListener('click', () => {
      state.drawEnabled = !state.drawEnabled;
      drawBtn.classList.toggle('active', state.drawEnabled);
      document.body.classList.toggle('drawing', state.drawEnabled);
    });

    clearBtn.addEventListener('click', () => { strokes = []; });

    narrativeText.classList.add('visible');
    narrativeLoop();
    setInterval(narrativeLoop, CONFIG.NARRATIVE_INTERVAL);
  </script>
</body>
</html>
