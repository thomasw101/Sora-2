<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$SORA - The Story of Sora</title>
  <meta name="description" content="A living story written by the market. Watch Sora's journey unfold in real-time.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Space+Mono:wght@400;700&family=Cinzel:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --parchment: #f4e4c8;
      --parchment-dark: #e8d4b0;
      --ink: #2a1f15;
      --ink-light: #4a3a2a;
      --gold: #c4a87c;
      --gold-bright: #d4b88c;
      --wood: #3d2a1a;
      --wood-dark: #2a1c14;
      --ember: #f97316;
      --blood: #991b1b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Crimson Text', Georgia, serif;
      background: #0a0806;
      color: var(--parchment);
      overflow-x: hidden;
    }

    /* ==================== CONFIG ==================== */
    /* Edit these values when you launch */

    /* ==================== HERO SECTION ==================== */
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      background: radial-gradient(ellipse at center bottom, #1a1510 0%, #0a0806 70%);
      padding: 40px 20px;
    }

    .hero-content {
      text-align: center;
      z-index: 10;
    }

    .hero-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(2.5rem, 8vw, 5rem);
      font-weight: 400;
      letter-spacing: 0.15em;
      color: var(--gold);
      text-shadow: 0 0 60px rgba(196, 168, 124, 0.3);
      margin-bottom: 10px;
    }

    .hero-subtitle {
      font-family: 'Space Mono', monospace;
      font-size: clamp(1rem, 3vw, 1.5rem);
      letter-spacing: 0.3em;
      color: var(--gold-bright);
      margin-bottom: 40px;
    }

    .hero-tagline {
      font-size: 1.2rem;
      font-style: italic;
      color: rgba(244, 228, 200, 0.7);
      max-width: 500px;
      margin: 0 auto 40px;
      line-height: 1.6;
    }

    .hero-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      font-family: 'Space Mono', monospace;
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      padding: 15px 35px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      text-transform: uppercase;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--gold) 0%, #a08050 100%);
      color: var(--ink);
      box-shadow: 0 4px 20px rgba(196, 168, 124, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(196, 168, 124, 0.5);
    }

    .btn-secondary {
      background: transparent;
      color: var(--gold);
      border: 1px solid var(--gold);
    }

    .btn-secondary:hover {
      background: rgba(196, 168, 124, 0.1);
    }

    .scroll-indicator {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      color: var(--gold);
      opacity: 0.6;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(10px); }
    }

    /* ==================== LIVE STORY SECTION ==================== */
    .live-story {
      min-height: 100vh;
      background: linear-gradient(180deg, #0a0806 0%, #1a1510 30%, #2a1f15 100%);
      padding: 60px 20px;
      position: relative;
    }

    .live-header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .live-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(153, 27, 27, 0.2);
      border: 1px solid rgba(153, 27, 27, 0.5);
      padding: 10px 20px;
      border-radius: 8px;
    }

    .live-dot {
      width: 10px;
      height: 10px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .live-badge span {
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      color: #ef4444;
      letter-spacing: 0.15em;
    }

    .era-badge {
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      letter-spacing: 0.2em;
      color: var(--gold);
    }

    .beat-badge {
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      color: var(--ink-light);
      background: rgba(196, 168, 124, 0.1);
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid rgba(196, 168, 124, 0.2);
    }

    .beat-badge span { color: var(--gold); }

    /* Desk and Scroll */
    .desk-container {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }

    .desk-surface {
      background: linear-gradient(180deg, var(--wood) 0%, var(--wood-dark) 100%);
      border-radius: 8px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .desk-grain {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: repeating-linear-gradient(
        90deg,
        transparent 0px, transparent 100px,
        rgba(0,0,0,0.1) 100px, rgba(0,0,0,0.1) 102px
      );
      border-radius: 8px;
      pointer-events: none;
    }

    .scroll-paper {
      background: linear-gradient(180deg, var(--parchment) 0%, var(--parchment-dark) 100%);
      border-radius: 4px;
      padding: 50px 40px;
      min-height: 400px;
      position: relative;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
    }

    .scroll-top, .scroll-bottom {
      position: absolute;
      left: -10px;
      right: -10px;
      height: 30px;
      background: linear-gradient(90deg, #8b7355 0%, #6b5344 50%, #8b7355 100%);
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .scroll-top { top: -15px; }
    .scroll-bottom { bottom: -15px; }

    .narrative-container {
      min-height: 250px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .narrative-text {
      font-size: clamp(1.3rem, 4vw, 1.8rem);
      line-height: 1.8;
      color: var(--ink);
      text-align: center;
      font-style: italic;
      max-width: 700px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .narrative-text.visible { opacity: 1; }

    .narrative-text.typing::after {
      content: '|';
      animation: blink 0.6s infinite;
      color: var(--ink-light);
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Sound button */
    .sound-toggle {
      display: flex;
      justify-content: center;
      margin-top: 30px;
    }

    .sound-btn {
      font-family: 'Space Mono', monospace;
      font-size: 0.8rem;
      padding: 12px 25px;
      background: rgba(196, 168, 124, 0.1);
      border: 1px solid rgba(196, 168, 124, 0.3);
      color: var(--gold);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sound-btn:hover {
      background: rgba(196, 168, 124, 0.2);
    }

    .sound-btn.active {
      background: rgba(74, 222, 128, 0.1);
      border-color: rgba(74, 222, 128, 0.3);
      color: #4ade80;
    }

    /* Tech Pipeline */
    .tech-pipeline {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-top: 40px;
      padding: 20px;
      background: rgba(10, 8, 6, 0.8);
      border-radius: 12px;
      border: 1px solid rgba(196, 168, 124, 0.1);
      flex-wrap: wrap;
    }

    .pipeline-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 10px 15px;
    }

    .node-icon {
      width: 45px;
      height: 45px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .node-icon.price { background: linear-gradient(135deg, #0f3d1f, #1a5c30); }
    .node-icon.price.down { background: linear-gradient(135deg, #3d0f0f, #5c1a1a); }
    .node-icon.ai { background: linear-gradient(135deg, #0f1f3d, #1a305c); }
    .node-icon.story { background: linear-gradient(135deg, #3d2a0f, #5c401a); }
    .node-icon.voice { background: linear-gradient(135deg, #2a0f3d, #401a5c); }

    .node-label {
      font-family: 'Space Mono', monospace;
      font-size: 0.65rem;
      letter-spacing: 0.1em;
      color: rgba(196, 168, 124, 0.6);
      text-transform: uppercase;
    }

    .node-value {
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      color: var(--gold);
    }

    .node-value.up { color: #4ade80; }
    .node-value.down { color: #f87171; }

    .pipeline-arrow {
      color: rgba(196, 168, 124, 0.3);
      font-size: 1.5rem;
    }

    /* Drawing Canvas */
    .drawing-section {
      margin-top: 40px;
      text-align: center;
    }

    .drawing-hint {
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      color: rgba(196, 168, 124, 0.5);
      margin-bottom: 15px;
    }

    .drawing-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%232a1f15" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg>') 0 24, crosshair;
      border-radius: 4px;
      z-index: 5;
    }

    .clear-canvas {
      font-family: 'Space Mono', monospace;
      font-size: 0.7rem;
      padding: 8px 16px;
      background: transparent;
      border: 1px solid rgba(196, 168, 124, 0.2);
      color: var(--gold);
      border-radius: 4px;
      cursor: pointer;
      margin-top: 15px;
    }

    .clear-canvas:hover {
      background: rgba(196, 168, 124, 0.1);
    }

    /* ==================== FOUNDLING SECTION ==================== */
    .foundling {
      padding: 100px 20px;
      background: linear-gradient(180deg, #2a1f15 0%, #1a1510 100%);
    }

    .section-title {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.8rem, 5vw, 2.5rem);
      text-align: center;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 50px;
    }

    .lore-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .lore-scroll {
      background: linear-gradient(180deg, var(--parchment) 0%, var(--parchment-dark) 100%);
      padding: 50px 40px;
      border-radius: 4px;
      position: relative;
    }

    .lore-text {
      font-size: 1.15rem;
      line-height: 1.9;
      color: var(--ink);
      text-align: justify;
    }

    .lore-text p { margin-bottom: 20px; }
    .lore-text p:last-child { margin-bottom: 0; }

    /* ==================== TOKENOMICS ==================== */
    .tokenomics {
      padding: 100px 20px;
      background: #0a0806;
      text-align: center;
    }

    .token-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
      max-width: 800px;
      margin: 0 auto 50px;
    }

    .token-card {
      background: rgba(196, 168, 124, 0.05);
      border: 1px solid rgba(196, 168, 124, 0.1);
      padding: 30px 20px;
      border-radius: 8px;
    }

    .token-value {
      font-family: 'Cinzel', serif;
      font-size: 1.8rem;
      color: var(--gold);
      margin-bottom: 10px;
    }

    .token-label {
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      color: rgba(244, 228, 200, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .contract-box {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: rgba(42, 31, 21, 0.5);
      border: 1px solid rgba(196, 168, 124, 0.2);
      border-radius: 8px;
    }

    .contract-label {
      font-family: 'Space Mono', monospace;
      font-size: 0.7rem;
      color: rgba(196, 168, 124, 0.5);
      margin-bottom: 10px;
    }

    .contract-address {
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      color: var(--gold);
      word-break: break-all;
    }

    /* ==================== FOOTER ==================== */
    .footer {
      padding: 40px 20px;
      text-align: center;
      border-top: 1px solid rgba(196, 168, 124, 0.1);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .footer-links a {
      color: var(--gold);
      text-decoration: none;
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
    }

    .footer-links a:hover { text-decoration: underline; }

    .disclaimer {
      font-size: 0.75rem;
      color: rgba(244, 228, 200, 0.4);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* ==================== AUDIO ==================== */
    #audio-player { display: none; }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 768px) {
      .desk-surface { padding: 25px; }
      .scroll-paper { padding: 35px 25px; }
      .tech-pipeline { gap: 10px; }
      .pipeline-arrow { display: none; }
    }
  </style>
</head>
<body>
  <!-- ==================== HERO ==================== -->
  <section class="hero" id="hero">
    <div class="hero-content">
      <h1 class="hero-title">THE STORY OF SORA</h1>
      <div class="hero-subtitle">$SORA</div>
      <p class="hero-tagline">A living story written by the market. Every trade shapes his journey. Every holder becomes part of the legend.</p>
      <div class="hero-buttons">
        <a href="#live-story" class="btn btn-primary">Watch the Story</a>
        <a id="buy-btn" href="#" target="_blank" class="btn btn-secondary">Buy $SORA</a>
      </div>
    </div>
    <div class="scroll-indicator">
      <span style="font-size: 0.8rem; font-family: 'Space Mono', monospace;">Scroll</span>
      <span>‚Üì</span>
    </div>
  </section>

  <!-- ==================== LIVE STORY ==================== -->
  <section class="live-story" id="live-story">
    <div class="live-header">
      <div class="live-badge">
        <div class="live-dot"></div>
        <span>LIVE</span>
      </div>
      <div class="era-badge" id="era-display">THE ASH</div>
      <div class="beat-badge">BEAT <span id="beat-display">#0</span></div>
    </div>

    <div class="desk-container">
      <div class="desk-surface">
        <div class="desk-grain"></div>
        <div class="scroll-paper">
          <div class="scroll-top"></div>
          <canvas class="drawing-canvas" id="drawing-canvas"></canvas>
          <div class="narrative-container">
            <div class="narrative-text" id="narrative-text">Awaiting the story...</div>
          </div>
          <div class="scroll-bottom"></div>
        </div>
      </div>

      <div class="sound-toggle">
        <button class="sound-btn" id="sound-btn">
          <span id="sound-icon">üîá</span>
          <span id="sound-label">Enable Sound</span>
        </button>
      </div>

      <div class="drawing-section">
        <div class="drawing-hint">‚úèÔ∏è Draw on the scroll with your mouse</div>
        <button class="clear-canvas" id="clear-canvas">Clear Drawing</button>
      </div>
    </div>

    <div class="tech-pipeline">
      <div class="pipeline-node">
        <div class="node-icon price" id="price-icon">üìà</div>
        <div class="node-label">Price</div>
        <div class="node-value" id="price-value">$0</div>
      </div>
      <div class="pipeline-arrow">‚Üí</div>
      <div class="pipeline-node">
        <div class="node-icon ai">üß†</div>
        <div class="node-label">AI</div>
        <div class="node-value">Gemini</div>
      </div>
      <div class="pipeline-arrow">‚Üí</div>
      <div class="pipeline-node">
        <div class="node-icon story">üìñ</div>
        <div class="node-label">Story</div>
        <div class="node-value" id="story-value">Beat #0</div>
      </div>
      <div class="pipeline-arrow">‚Üí</div>
      <div class="pipeline-node">
        <div class="node-icon voice">üîä</div>
        <div class="node-label">Voice</div>
        <div class="node-value">TTS</div>
      </div>
    </div>
  </section>

  <!-- ==================== THE FOUNDLING ==================== -->
  <section class="foundling" id="foundling">
    <h2 class="section-title">THE FOUNDLING</h2>
    <div class="lore-container">
      <div class="lore-scroll">
        <div class="lore-text">
          <p>They left him in the ash. A boy of fifteen winters, with nothing but a wooden fox carved by his mother's hand and a blade pulled from a dead man's grip.</p>
          <p>The shrine had burned three days before he woke. He never found their bodies. Perhaps they fled. Perhaps they were taken. Perhaps they simply decided that survival would be easier without another mouth to feed.</p>
          <p>Sora does not speak of them. The wooden fox remembers. The blade forgets.</p>
          <p>Now he walks the dead roads between ruined villages, trading silence for shelter, violence for bread. Each day the empire of ash grows smaller behind him. Each night the wooden fox watches from his chest pocket, its painted eyes catching the firelight.</p>
          <p>They say a boy cannot build an empire. They say blood is thicker than ash. They say the old families will rise again and reclaim what was lost.</p>
          <p>Sora says nothing. He only walks. And behind him, in the shadows between the burnt trees, others have begun to follow.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ==================== TOKENOMICS ==================== -->
  <section class="tokenomics" id="tokenomics">
    <h2 class="section-title">TOKENOMICS</h2>
    <div class="token-grid">
      <div class="token-card">
        <div class="token-value">1B</div>
        <div class="token-label">Total Supply</div>
      </div>
      <div class="token-card">
        <div class="token-value">0%</div>
        <div class="token-label">Tax</div>
      </div>
      <div class="token-card">
        <div class="token-value">100%</div>
        <div class="token-label">Fair Launch</div>
      </div>
    </div>
    <div class="contract-box">
      <div class="contract-label">Contract Address</div>
      <div class="contract-address" id="contract-display">Coming Soon...</div>
    </div>
  </section>

  <!-- ==================== FOOTER ==================== -->
  <footer class="footer">
    <div class="footer-links">
      <a href="https://x.com/storytimeliveai" target="_blank">Twitter</a>
      <a id="footer-buy" href="#" target="_blank">Buy on Bags.fm</a>
    </div>
    <p class="disclaimer">$SORA is a meme coin with no intrinsic value or expectation of financial return. This is an art project and social experiment. Trade responsibly.</p>
  </footer>

  <audio id="audio-player"></audio>

  <script>
    // ==================== CONFIGURATION ====================
    // Edit these when you launch:
    const CONFIG = {
      TOKEN_ADDRESS: 'YOUR_TOKEN_ADDRESS_HERE',
      BUY_URL: 'https://bags.fm/YOUR_COIN',
      NARRATIVE_INTERVAL: 25000 // 25 seconds
    };

    // Update links
    document.getElementById('buy-btn').href = CONFIG.BUY_URL;
    document.getElementById('footer-buy').href = CONFIG.BUY_URL;
    if (CONFIG.TOKEN_ADDRESS !== 'YOUR_TOKEN_ADDRESS_HERE') {
      document.getElementById('contract-display').textContent = CONFIG.TOKEN_ADDRESS;
    }

    // ==================== STATE ====================
    const state = {
      soundEnabled: false,
      isTyping: false
    };

    // ==================== ELEMENTS ====================
    const narrativeText = document.getElementById('narrative-text');
    const eraDisplay = document.getElementById('era-display');
    const beatDisplay = document.getElementById('beat-display');
    const priceValue = document.getElementById('price-value');
    const priceIcon = document.getElementById('price-icon');
    const storyValue = document.getElementById('story-value');
    const soundBtn = document.getElementById('sound-btn');
    const soundIcon = document.getElementById('sound-icon');
    const soundLabel = document.getElementById('sound-label');
    const audioPlayer = document.getElementById('audio-player');

    // ==================== ERA NAMES ====================
    const eraNames = {
      'THE_ASH': 'THE ASH',
      'THE_GATE': 'THE GATE',
      'THE_RONIN': 'THE RONIN',
      'THE_EMPIRE': 'THE EMPIRE',
      'THE_BEYOND': 'THE BEYOND'
    };

    // ==================== TYPEWRITER ====================
    async function typeText(text) {
      state.isTyping = true;
      narrativeText.classList.add('visible', 'typing');
      narrativeText.textContent = '';

      for (const char of text) {
        narrativeText.textContent += char;
        const delay = char === '.' ? 80 : char === ',' ? 40 : 25;
        await new Promise(r => setTimeout(r, delay));
      }

      narrativeText.classList.remove('typing');
      state.isTyping = false;
    }

    // ==================== FADE ====================
    function fadeOutNarrative() {
      return new Promise(resolve => {
        narrativeText.classList.remove('visible');
        setTimeout(resolve, 500);
      });
    }

    // ==================== FETCH NARRATIVE ====================
    async function fetchNarrative() {
      try {
        const url = `/api/narrative?token=${CONFIG.TOKEN_ADDRESS}&audio=${state.soundEnabled}`;
        const response = await fetch(url);
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Failed to fetch narrative:', error);
        return null;
      }
    }

    // ==================== DISPLAY NARRATIVE ====================
    async function displayNarrative(data) {
      if (!data) return;

      // Update UI
      eraDisplay.textContent = eraNames[data.era] || data.era;
      beatDisplay.textContent = '#' + data.beatCount;
      storyValue.textContent = 'Beat #' + data.beatCount;

      if (data.marketCap) {
        priceValue.textContent = '$' + Math.round(data.marketCap).toLocaleString();
        priceValue.className = 'node-value' + (data.momentum === 'UP' ? ' up' : data.momentum === 'DOWN' ? ' down' : '');
        priceIcon.className = 'node-icon price' + (data.momentum === 'DOWN' ? ' down' : '');
      }

      // Fade out old text
      await fadeOutNarrative();

      // Type new text
      await typeText(data.narrative);

      // Play audio if enabled
      if (state.soundEnabled && data.audio) {
        try {
          const audioBlob = new Blob(
            [Uint8Array.from(atob(data.audio), c => c.charCodeAt(0))],
            { type: 'audio/mp3' }
          );
          audioPlayer.src = URL.createObjectURL(audioBlob);
          audioPlayer.play();
        } catch (e) {
          console.error('Audio error:', e);
        }
      }
    }

    // ==================== NARRATIVE LOOP ====================
    async function narrativeLoop() {
      const data = await fetchNarrative();
      await displayNarrative(data);
    }

    // ==================== SOUND TOGGLE ====================
    soundBtn.addEventListener('click', () => {
      state.soundEnabled = !state.soundEnabled;
      soundBtn.classList.toggle('active', state.soundEnabled);
      soundIcon.textContent = state.soundEnabled ? 'üîä' : 'üîá';
      soundLabel.textContent = state.soundEnabled ? 'Sound On' : 'Enable Sound';
    });

    // ==================== DRAWING CANVAS ====================
    const canvas = document.getElementById('drawing-canvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let inkStrokes = [];

    function resizeCanvas() {
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      redrawStrokes();
    }

    function redrawStrokes() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const now = Date.now();
      inkStrokes = inkStrokes.filter(stroke => now - stroke.time < 8000);

      inkStrokes.forEach(stroke => {
        const age = now - stroke.time;
        const opacity = Math.max(0, 1 - age / 8000);
        ctx.strokeStyle = `rgba(42, 31, 21, ${opacity})`;
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(stroke.x1, stroke.y1);
        ctx.lineTo(stroke.x2, stroke.y2);
        ctx.stroke();
      });

      requestAnimationFrame(redrawStrokes);
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
      return { x, y };
    }

    function startDraw(e) {
      isDrawing = true;
      const pos = getPos(e);
      lastX = pos.x;
      lastY = pos.y;
    }

    function draw(e) {
      if (!isDrawing) return;
      e.preventDefault();
      const pos = getPos(e);
      inkStrokes.push({
        x1: lastX, y1: lastY,
        x2: pos.x, y2: pos.y,
        time: Date.now()
      });
      lastX = pos.x;
      lastY = pos.y;
    }

    function stopDraw() {
      isDrawing = false;
    }

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseleave', stopDraw);
    canvas.addEventListener('touchstart', startDraw);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDraw);

    document.getElementById('clear-canvas').addEventListener('click', () => {
      inkStrokes = [];
    });

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    redrawStrokes();

    // ==================== START ====================
    // Initial load
    narrativeLoop();

    // Start the loop
    setInterval(narrativeLoop, CONFIG.NARRATIVE_INTERVAL);

    // Show initial text
    narrativeText.classList.add('visible');
  </script>
</body>
</html>
